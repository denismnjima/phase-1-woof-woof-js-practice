<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog App</title>
</head>
<body>
    <div id="dog-bar"></div>
    <div id="dog-info"></div>
    <button id="filter-btn">Filter good dogs: OFF</button>

    <script>
        let filterGoodDogs = false;

        document.addEventListener('DOMContentLoaded', () => {
            fetchDogs();

            document.getElementById('filter-btn').addEventListener('click', () => {
                filterGoodDogs = !filterGoodDogs;
                document.getElementById('filter-btn').innerText = filterGoodDogs ? 'Filter good dogs: ON' : 'Filter good dogs: OFF';
                fetchDogs();
            });
        });

        function fetchDogs() {
            fetch('http://localhost:3000/pups')
                .then(response => response.json())
                .then(pups => {
                    const dogBar = document.getElementById('dog-bar');
                    dogBar.innerHTML = '';
                    pups.forEach(pup => {
                        if (!filterGoodDogs || pup.isGoodDog) {
                            const span = document.createElement('span');
                            span.innerText = pup.name;
                            span.addEventListener('click', () => showPupInfo(pup));
                            dogBar.appendChild(span);
                        }
                    });
                });
        }

        function showPupInfo(pup) {
            const dogInfo = document.getElementById('dog-info');
            dogInfo.innerHTML = `
                <img src="${pup.image}" alt="${pup.name}" />
                <h2>${pup.name}</h2>
                <button id="toggle-goodness-btn">${pup.isGoodDog ? 'Good Dog!' : 'Bad Dog!'}</button>
            `;
            document.getElementById('toggle-goodness-btn').addEventListener('click', () => toggleGoodness(pup));
        }

        function toggleGoodness(pup) {
            const newStatus = !pup.isGoodDog;
            fetch(`http://localhost:3000/pups/${pup.id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ isGoodDog: newStatus })
            })
            .then(response => response.json())
            .then(updatedPup => {
                document.getElementById('toggle-goodness-btn').innerText = updatedPup.isGoodDog ? 'Good Dog!' : 'Bad Dog!';
                fetchDogs();
            });
        }
    </script>
</body>
</html>
